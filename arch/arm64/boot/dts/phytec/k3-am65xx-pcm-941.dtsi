// SPDX-License-Identifier: GPL-2.0
/*
 * Copyright (C) 2018 PHYTEC America, LLC - https://www.phytec.com
 */

#include <dt-bindings/phy/phy.h>

/ {
	model = "PHYTEC phyCORE-AM65x Carrier Board";
	compatible = "phytec,am65xx-pcm-941", "phytec,am65xx-phycore-som", "ti,am654";

	aliases {
		ethernet1 = &pruss1_emac0;
		ethernet2 = &pruss1_emac1;
	};

	chosen {
		/* UART1 as default stdout path */
		stdout-path = &main_uart1;
		bootargs = "earlycon=ns16550a,mmio32,0x02810000";
	};

	/* fan set always on */
	gpio_fan: gpio_fan {
		compatible = "gpio-leds";
		pinctrl-names = "default";
		pinctrl-0 = <&gpio_fan_pins_default>;

		fan@0 {
			label = "am65xx-pcm-941:fan";
			gpios = <&main_gpio1 49 GPIO_ACTIVE_HIGH>;
			default-state = "on";
		};
	};

	/* Dual Ethernet application node on PRU-ICSSG1 */
	pruss1_eth: pruss1_eth {
		compatible = "ti,am654-icssg-prueth";
		pinctrl-names = "default";
		pinctrl-0 = <&icssg1_rgmii_pins_default>;
		sram = <&msmc_ram>;
		interrupt-parent = <&main_udmass_inta>;

		prus = <&pru1_0>, <&rtu1_0>, <&pru1_1>, <&rtu1_1>;
		firmware-name = "ti-pruss/am65x-pru0-prueth-fw.elf",
				"ti-pruss/am65x-rtu0-prueth-fw.elf",
				"ti-pruss/am65x-pru1-prueth-fw.elf",
				"ti-pruss/am65x-rtu1-prueth-fw.elf";
		mii-g-rt = <&icssg1_mii_g_rt>;
		mii-rt = <&icssg1_mii_rt>;
		dma-coherent;
		dmas = <&main_udmap &icssg1 0 UDMA_DIR_TX>,	/* SLICE 0 */
		       <&main_udmap &icssg1 0 UDMA_DIR_RX>,
		       <&main_udmap &icssg1 4 UDMA_DIR_TX>,	/* SLICE 1 */
		       <&main_udmap &icssg1 1 UDMA_DIR_RX>;
		dma-names = "tx0", "rx0", "tx1", "rx1";

		pruss1_emac0: ethernet-mii0 {
			phy-handle = <&pruss1_eth1_phy>;
			phy-mode = "rgmii-id";
			syscon-rgmii-delay = <&scm_conf 0x4110>;
			/* Filled in by bootloader */
			local-mac-address = [00 00 00 00 00 00];
		};

		pruss1_emac1: ethernet-mii1 {
			phy-handle = <&pruss1_eth2_phy>;
			phy-mode = "rgmii-id";
			syscon-rgmii-delay = <&scm_conf 0x4114>;
			/* Filled in by bootloader */
			local-mac-address = [00 00 00 00 00 00];
		};
	};
};

&main_pmx0 {
	gpio_fan_pins_default: gpio_fan_pins_default {
		pinctrl-single,pins = <
			AM65X_IOPAD(0x0244, PIN_OUTPUT | MUX_MODE7) /* (AB28) PRG0_PRU1_GPO0.GPIO1_49 */
		>;
	};

	icssg1_mdio_pins_default: icssg1_mdio_pins_default {
		pinctrl-single,pins = <
			AM65X_IOPAD(0x0180, PIN_INPUT | MUX_MODE0)	/* (AD18) PRG1_MDIO0_MDIO */
			AM65X_IOPAD(0x0184, PIN_OUTPUT | MUX_MODE0)	/* (AH18) PRG1_MDIO0_MDC */
		>;
	};

	icssg1_rgmii_pins_default: icssg1_rgmii_pins_default {
		pinctrl-single,pins = <
			AM65X_IOPAD(0x00e0, PIN_INPUT | MUX_MODE2)	/* (AE22) PRG1_PRU0_GPO0.PRG1_RGMII1_RD0 */
			AM65X_IOPAD(0x00e4, PIN_INPUT | MUX_MODE2)	/* (AG24) PRG1_PRU0_GPO1.PRG1_RGMII1_RD1 */
			AM65X_IOPAD(0x00e8, PIN_INPUT | MUX_MODE2)	/* (AF23) PRG1_PRU0_GPO2.PRG1_RGMII1_RD2 */
			AM65X_IOPAD(0x00ec, PIN_INPUT | MUX_MODE2)	/* (AD21) PRG1_PRU0_GPO3.PRG1_RGMII1_RD3 */
			AM65X_IOPAD(0x00f0, PIN_INPUT | MUX_MODE2)	/* (AG23) PRG1_PRU0_GPO4.PRG1_RGMII1_RX_CTL */
			AM65X_IOPAD(0x00f8, PIN_INPUT | MUX_MODE2)	/* (AF22) PRG1_PRU0_GPO6.PRG1_RGMII1_RXC */
			AM65X_IOPAD(0x010c, PIN_OUTPUT | MUX_MODE2)	/* (AF21) PRG1_PRU0_GPO11.PRG1_RGMII1_TX_CTL */
			AM65X_IOPAD(0x0110, PIN_OUTPUT | MUX_MODE2)	/* (AH20) PRG1_PRU0_GPO12.PRG1_RGMII1_TD0 */
			AM65X_IOPAD(0x0114, PIN_OUTPUT | MUX_MODE2)	/* (AH21) PRG1_PRU0_GPO13.PRG1_RGMII1_TD1 */
			AM65X_IOPAD(0x0118, PIN_OUTPUT | MUX_MODE2)	/* (AG20) PRG1_PRU0_GPO14.PRG1_RGMII1_TD2 */
			AM65X_IOPAD(0x011c, PIN_OUTPUT | MUX_MODE2)	/* (AD19) PRG1_PRU0_GPO15.PRG1_RGMII1_TD3 */
			AM65X_IOPAD(0x0120, PIN_INPUT | MUX_MODE2)	/* (AD20) PRG1_PRU0_GPO16.PRG1_RGMII1_TXC */

			AM65X_IOPAD(0x0130, PIN_INPUT | MUX_MODE2)	/* (AH24) PRG1_PRU1_GPO0.PRG1_RGMII2_RD0 */
			AM65X_IOPAD(0x0134, PIN_INPUT | MUX_MODE2)	/* (AH23) PRG1_PRU1_GPO1.PRG1_RGMII2_RD1 */
			AM65X_IOPAD(0x0138, PIN_INPUT | MUX_MODE2)	/* (AG21) PRG1_PRU1_GPO2.PRG1_RGMII2_RD2 */
			AM65X_IOPAD(0x013c, PIN_INPUT | MUX_MODE2)	/* (AH22) PRG1_PRU1_GPO3.PRG1_RGMII2_RD3 */
			AM65X_IOPAD(0x0140, PIN_INPUT | MUX_MODE2)	/* (AE21) PRG1_PRU1_GPO4.PRG1_RGMII2_RX_CTL */
			AM65X_IOPAD(0x0148, PIN_INPUT | MUX_MODE2)	/* (AG22) PRG1_PRU1_GPO6.PRG1_RGMII2_RXC */
			AM65X_IOPAD(0x015c, PIN_OUTPUT | MUX_MODE2)	/* (AC20) PRG1_PRU1_GPO11.PRG1_RGMII2_TX_CTL */
			AM65X_IOPAD(0x0160, PIN_OUTPUT | MUX_MODE2)	/* (AE20) PRG1_PRU1_GPO12.PRG1_RGMII2_TD0 */
			AM65X_IOPAD(0x0164, PIN_OUTPUT | MUX_MODE2)	/* (AF19) PRG1_PRU1_GPO13.PRG1_RGMII2_TD1 */
			AM65X_IOPAD(0x0168, PIN_OUTPUT | MUX_MODE2)	/* (AH19) PRG1_PRU1_GPO14.PRG1_RGMII2_TD2 */
			AM65X_IOPAD(0x016c, PIN_OUTPUT | MUX_MODE2)	/* (AG19) PRG1_PRU1_GPO15.PRG1_RGMII2_TD3 */
			AM65X_IOPAD(0x0170, PIN_INPUT | MUX_MODE2)	/* (AE19) PRG1_PRU1_GPO16.PRG1_RGMII2_TXC */
		>;
	};

	main_mmc1_pins_default: main_mmc1_pins_default {
		pinctrl-single,pins = <
			AM65X_IOPAD(0x02c4, PIN_INPUT_PULLUP | MUX_MODE0)	/* (D27) MMC1_DAT3 */
			AM65X_IOPAD(0x02c8, PIN_INPUT_PULLUP | MUX_MODE0)	/* (D26) MMC1_DAT2 */
			AM65X_IOPAD(0x02cc, PIN_INPUT_PULLUP | MUX_MODE0)	/* (E27) MMC1_DAT1 */
			AM65X_IOPAD(0x02d0, PIN_INPUT_PULLUP | MUX_MODE0)	/* (D28) MMC1_DAT0 */
			AM65X_IOPAD(0x02d4, PIN_INPUT_PULLDOWN | MUX_MODE0)	/* (C27) MMC1_CLK */
			AM65X_IOPAD(0x02d8, PIN_INPUT_PULLUP | MUX_MODE0)	/* (C28) MMC1_CMD */
			AM65X_IOPAD(0x02dc, PIN_INPUT | MUX_MODE0)		/* (B24) MMC1_SDCD */
		>;
	};

	main_uart1_pins_default: main_uart1_pins_default {
		pinctrl-single,pins = <
			AM65X_IOPAD(0x014c, PIN_OUTPUT | MUX_MODE6)	/* (AD23) PRG1_PRU1GPO6.UART1_TXD */
			AM65X_IOPAD(0x0174, PIN_INPUT | MUX_MODE6)	/* (AE23) PRG1_PRU1GPO17.UART1_RXD */
			AM65X_IOPAD(0x0178, PIN_INPUT | MUX_MODE6)	/* (AD22) PRG1_PRU1GPO18.UART1_CTS */
			AM65X_IOPAD(0x017c, PIN_OUTPUT | MUX_MODE6)	/* (AC21) PRG1_PRU1GPO19.UART1_RTS */
		>;
	};

	usb1_pins_default: usb1_pins_default {
		pinctrl-single,pins = <
			AM65X_IOPAD(0x02c0, PIN_OUTPUT | MUX_MODE0)	/* (AC8) USB1_DRVVBUS */
		>;
	};
};

&icssg1_mdio {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&icssg1_mdio_pins_default>;

	pruss1_eth1_phy: ethernet-phy@1 {
		reg = <1>;
		ti,rx-internal-delay = <DP83867_RGMIIDCTL_2_00_NS>;
		ti,tx-internal-delay = <DP83867_RGMIIDCTL_2_00_NS>;
		ti,fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_4_B_NIB>;
	};

	pruss1_eth2_phy: ethernet-phy@2 {
		reg = <2>;
		ti,rx-internal-delay = <DP83867_RGMIIDCTL_2_00_NS>;
		ti,tx-internal-delay = <DP83867_RGMIIDCTL_2_00_NS>;
		ti,fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_4_B_NIB>;
	};
};

&mmc_phy1 {
	status = "okay";
	ti,driver-strength-ohm = <50>;
};

&sdhci1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&main_mmc1_pins_default>;
	sdhci-caps-mask = <0x80000007 0x0>;
};

&pcie1_rc {
	status = "okay";
	phys = <&serdes1 PHY_TYPE_PCIE 0>;
	phy-names = "pcie-phy0";
};

&serdes1 {
	status = "okay";
};

&main_uart1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&main_uart1_pins_default>;
};

&dwc3_1 {
	status = "okay";
};

&usb1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&usb1_pins_default>;
	dr_mode = "otg";
};

&usb1_phy {
	status = "okay";
};
